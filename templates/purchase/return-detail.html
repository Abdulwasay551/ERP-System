{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Purchase Return #{{ return_obj.return_number }} | FutureERP{% endblock %}

{% block extra_css %}
<style>
    .return-header {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
        border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .status-badge {
        @apply px-3 py-1 rounded-full text-xs font-medium;
    }
    
    .status-pending {
        @apply bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300;
    }
    
    .status-completed {
        @apply bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300;
    }
    
    .status-cancelled {
        @apply bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300;
    }
    
    .info-card {
        @apply bg-white dark:bg-green-900/20 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-green-800/30;
    }
    
    .info-label dark:text-gray-300 {
        @apply text-sm font-medium text-gray-500 dark:text-gray-300;
    }
    
    .info-value dark:text-white {
        @apply mt-1 text-sm text-gray-900 dark:text-gray-200;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Header -->
    <div class="return-header rounded-lg p-6 mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                    Return #{{ return.return_number }}
                </h1>
                <div class="flex items-center mt-2">
                    <span class="dark:text-white status-badge status-{{ return.status|lower }}">
                        {{ return.get_status_display }}
                    </span>
                    <span class="ml-2 text-sm text-gray-500 dark:text-gray-300">
                        Created on {{ return.created_at|date:"M d, Y" }}
                    </span>
                </div>
            </div>
            <div class="mt-4 md:mt-0">
                <div class="flex space-x-3">
                    <a href="{% url 'purchase:returns_ui' %}" 
                       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-green-700/20 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Back to List
                    </a>
                    {% if return.status == 'pending' %}
                        <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Process Return
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Return Items -->
            <div class="info-card">
                <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Return Items</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-green-800/30">
                        <thead class="bg-gray-50 dark:bg-green-700/20">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Item</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Quantity</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Unit Price</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-green-900/20 divide-y divide-gray-200 dark:divide-green-800/30">
                            {% for item in return.items.all %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900 dark:text-gray-200">
                                        {{ item.product.name }}
                                    </div>
                                    <div class="text-xs text-gray-500 dark:text-gray-300">
                                        {{ item.product.code|default:"No SKU" }}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200 text-right">
                                    {{ item.quantity }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200 text-right">
                                    {{ item.unit_price|floatformat:2|intcomma }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-200 text-right">
                                    {{ item.total|floatformat:2|intcomma }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="bg-gray-50 dark:bg-green-700/20">
                            <tr>
                                <th colspan="3" class="px-6 py-3 text-right text-sm font-medium text-gray-500 dark:text-gray-300">Subtotal</th>
                                <th class="px-6 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-200">
                                    {{ return.subtotal|floatformat:2|intcomma }}
                                </th>
                            </tr>
                            {% if return.tax_amount %}
                            <tr>
                                <th colspan="3" class="px-6 py-3 text-right text-sm font-medium text-gray-500 dark:text-gray-300">Tax</th>
                                <th class="px-6 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-200">
                                    {{ return.tax_amount|floatformat:2|intcomma }}
                                </th>
                            </tr>
                            {% endif %}
                            <tr>
                                <th colspan="3" class="px-6 py-3 text-right text-sm font-medium text-gray-500 dark:text-gray-300">Total</th>
                                <th class="px-6 py-3 text-right text-sm font-bold text-gray-900 dark:text-white">
                                    {{ return.total|floatformat:2|intcomma }}
                                </th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Return Reason & Notes -->
            {% if return.reason or return.notes %}
            <div class="info-card">
                <h2 class="text-2xl border-b border-t border-green-900/10 dark:border-green-900/40 py-4 font-medium text-gray-900 dark:text-gray-100 mb-4">Return Details</h2>
                {% if return.reason %}
                <div class="mb-4">
                    <h3 class="info-label dark:text-gray-300">Reason for Return:</h3>
                    <p class="info-value dark:text-white">{{ return.reason }}</p>
                </div>
                {% endif %}
                {% if return.notes %}
                <div>
                    <h3 class="info-label dark:text-gray-300">Additional Notes:</h3>
                    <p class="info-value dark:text-white whitespace-pre-line">{{ return.notes }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Right Column -->
        <div class="space-y-6 border-l border-green-900/10 dark:border-green-900/40 pl-2">
            <!-- Return Information -->
            <div class="info-card">
                <h2 class="text-xl border-b border-t border-green-900/10 dark:border-green-900/40 py-4 font-medium text-gray-900 dark:text-gray-100 mb-4">Return Information</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="info-label dark:text-gray-300">Return Number:</h3>
                        <p class="info-value dark:text-white">{{ return.return_number }}</p>
                    </div>
                    <div>
                        <h3 class="info-label dark:text-gray-300">Return Date:</h3>
                        <p class="info-value dark:text-white">{{ return.return_date|date:"M d, Y" }}</p>
                    </div>
                    <div>
                        <h3 class="info-label dark:text-gray-300">Status:</h3>
                        <p class="info-value dark:text-white">
                            <span class="status-badge status-{{ return.status|lower }}">
                                {{ return.get_status_display }}
                            </span>
                        </p>
                    </div>
                    {% if return.reference_number %}
                    <div>
                        <h3 class="info-label dark:text-gray-300">Reference Number:</h3>
                        <p class="info-value dark:text-white">{{ return.reference_number }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Supplier Information -->
            <div class="info-card">
                <h2 class="text-xl border-b border-t border-green-900/10 dark:border-green-900/40 py-4 font-medium text-gray-900 dark:text-gray-100 mb-4">Supplier</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="info-label dark:text-gray-300">Name:</h3>
                        <p class="info-value dark:text-white">{{ return.supplier.name }}</p>
                    </div>
                    {% if return.supplier.email %}
                    <div>
                        <h3 class="info-label dark:text-gray-300">Email:</h3>
                        <p class="info-value dark:text-white">{{ return.supplier.email }}</p>
                    </div>
                    {% endif %}
                    {% if return.supplier.phone %}
                    <div>
                        <h3 class="info-label dark:text-gray-300">Phone:</h3>
                        <p class="info-value dark:text-white">{{ return.supplier.phone }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Related Documents -->
            <div class="info-card">
                <h2 class="text-xl border-b border-t border-green-900/10 dark:border-green-900/40 py-4 font-medium text-gray-900 dark:text-gray-100 mb-4">Related Documents</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="info-label dark:text-gray-300">Purchase Order:</h3>
                        {% if return.purchase_order %}
                        <a href="{% url 'purchase:purchase_order_detail' return.purchase_order.id %}" 
                           class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300">
                            {{ return.purchase_order.po_number }}
                        </a>
                        {% else %}
                        <p class="info-value dark:text-white">No linked purchase order</p>
                        {% endif %}
                    </div>
                    {% if return.invoice_number %}
                    <div>
                        <h3 class="info-label dark:text-gray-300">Invoice Number:</h3>
                        <p class="info-value dark:text-white">{{ return.invoice_number }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Action Buttons -->
            {% if return.status == 'pending' %}
            <div class="flex flex-col space-y-2">
                <button type="button" 
                        class="inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Approve Return
                </button>
                <button type="button" 
                        class="inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Reject Return
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
